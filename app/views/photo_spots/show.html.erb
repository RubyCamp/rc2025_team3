<% content_for :title, @photo_spot.name %>
<div data-controller="image-modal">
  <div class="container mx-auto px-4 py-6">
    <% if notice.present? %>
      <div class="bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded mb-6">
        <%= notice %>
      </div>
    <% end %>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
      <div class="flex flex-col lg:flex-row lg:items-start lg:justify-between mb-6">
        <div class="flex-1">
          <h1 class="text-3xl font-bold text-gray-900 mb-2">
            <%= @photo_spot.name %>
            <span class="text-gray-600 text-lg font-normal">
              （<%= @photo_spot.reviews.count %>件のレビュー）
            </span>
          </h1>
          <% if @photo_spot.tags.present? %>
            <div class="flex flex-wrap gap-2 mb-4">
              <% @photo_spot.tags.split(",").each do |tag| %>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                  <%= tag.strip %>
                </span>
              <% end %>
            </div>
          <% end %>
          <div class="flex-1 min-w-0">
            <dl class="grid grid-cols-1 sm:grid-cols-2 gap-x-4 gap-y-2 text-sm text-gray-700 break-words">
              <dt class="font-semibold">名称</dt>
              <dd><%= @photo_spot.name %></dd>
              <dt class="font-semibold">説明</dt>
              <dd><%= @photo_spot.detail %></dd>
              <dt class="font-semibold">タグ</dt>
              <dd><%= @photo_spot.tags %></dd>
              <dt class="font-semibold">時間帯</dt>
              <dd>
                <%= @photo_spot.timestart ? @photo_spot.timestart.strftime("%H:%M") : "未設定" %> 〜
                <%= @photo_spot.timeend ? @photo_spot.timeend.strftime("%H:%M") : "未設定" %>
              </dd>
              <dt class="font-semibold">駐車場</dt>
              <dd>
                <% if @photo_spot.parking_flag == 1 %>
                  駐車場あり
                  <% if @photo_spot.parking_count %>
                    ：<%= @photo_spot.parking_count %> 台
                  <% end %>
                <% elsif @photo_spot.parking_flag == 0 %>
                  駐車場なし
                <% end %>
              </dd>
              <dt class="font-semibold">おすすめの季節</dt>
              <dd>
                <% case @photo_spot.season %>
                <% when 'spring' %>
                  春
                <% when 'summer' %>
                  夏
                <% when 'autumn' %>
                  秋
                <% when 'winter' %>
                  冬
                <% else %>
                  未設定
                <% end %>
              </dd>
            </dl>
          </div>
        </div>
        <div class="flex flex-col sm:flex-row gap-3 mt-4 lg:mt-0">
          <%= link_to "レビューを投稿", new_photo_spot_review_path(@photo_spot),
          class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" %>
        </div>
      </div>
      <% if @photo_spot.images.attached? %>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
          <% @photo_spot.images.limit(6).each_with_index do |image, index| %>
            <div class="relative group aspect-video overflow-hidden rounded-lg shadow-sm cursor-pointer"
              data-action="click->image-modal#open"
              data-image-modal-index-value="<%= index %>"
              data-image-modal-images-value="<%= @photo_spot.images.map { |i| url_for(i) }.to_json %>">
              <%= image_tag image.variant(resize_to_fill: [400, 225]),
                class: "w-full h-full object-cover group-hover:shadow-md transition-shadow duration-200",
                alt: "#{@photo_spot.name}の画像#{index + 1}" %>
              <% if index == 5 && @photo_spot.images.count > 6 %>
                <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center">
                  <span class="text-white text-lg font-semibold">
                    +<%= @photo_spot.images.count - 6 %>枚
                  </span>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% end %>
      <div class="prose max-w-none mb-6">
        <p class="text-gray-700 leading-relaxed"><%= simple_format(@photo_spot.detail) %></p>
      </div>
    </div>
    <%# モーダルウィンドウのHTML部分 %>
    <div data-image-modal-target="modal"
      class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-75 hidden">
      <div class="relative w-full h-full max-w-5xl">
        <div class="relative w-full h-full flex items-center justify-center">
          <img data-image-modal-target="image" class="max-w-full max-h-screen object-contain" alt="Enlarged image">
          <%# 閉じるボタン %>
          <button data-action="click->image-modal#close" class="absolute top-4 right-4 text-white text-4xl">
            &times;
          </button>
          <%# 左右の矢印ボタン %>
          <button data-action="click->image-modal#previous" data-image-modal-target="prevBtn" class="absolute left-4 top-1/2 -translate-y-1/2 text-white text-5xl">
            &lsaquo;
          </button>
          <button data-action="click->image-modal#next" data-image-modal-target="nextBtn" class="absolute right-4 top-1/2 -translate-y-1/2 text-white text-5xl">
            &rsaquo;
          </button>
        </div>
      </div>
    </div>
    <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
      <h2 class="text-2xl font-semibold text-gray-900 mb-6 flex items-center">
        <svg class="w-6 h-6 mr-2 text-yellow-500" fill="currentColor" viewBox="0 0 20 20">
          <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"/>
        </svg>
        レビュー
      </h2>
      <div class="space-y-4">
        <% if @reviews.any? %>
          <% @reviews.each do |review| %>
            <%= render partial: "reviews/review", locals: { review: review } %>
          <% end %>
        <% else %>
          <div class="text-center py-12 text-gray-500">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-3.582 8-8 8a8.001 8.001 0 01-7.938-7M5 20h-.5a2.5 2.5 0 010-5H5a8.001 8.001 0 017.938-7M5 20v-2a8.001 8.001 0 017.938-7H13.5a2.5 2.5 0 010 5H13a8.001 8.001 0 00-7.938 7z"/>
            </svg>
            <p class="text-lg">まだレビューが投稿されていません</p>
            <p class="text-sm mt-2">最初のレビューを投稿してみませんか？</p>
            <div class="mt-4">
              <%= link_to "最初のレビューを投稿", new_photo_spot_review_path(@photo_spot),
              class: "inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
    <div class="mt-6">
      <%= link_to "フォトスポット一覧に戻る", photo_spots_path,
      class: "inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-md hover:bg-gray-50" %>
    </div>
  </div>
</div>